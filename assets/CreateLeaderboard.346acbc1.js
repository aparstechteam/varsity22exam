var A=Object.defineProperty,D=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var E=(u,s,l)=>s in u?A(u,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[s]=l,b=(u,s)=>{for(var l in s||(s={}))R.call(s,l)&&E(u,l,s[l]);if(C)for(var l of C(s))I.call(s,l)&&E(u,l,s[l]);return u},k=(u,s)=>D(u,H(s));import{r as v,j as i,k as d,l as e,F as x,y as p,E as T,z as V,H as y,C as J,D as U,I as z,J as F,m as h}from"./index.dd2c6d6a.js";import{_ as S}from"./lodash.3660d49b.js";const M={class:"container mx-auto"},O={class:"print:hidden"},G=e("div",null,[e("h1",{class:"text-lg text-center"}," Select Exams and create leaderboard ")],-1),P={class:"max-w-2xl mx-auto mt-5 overflow-x-auto"},Q={class:"table w-full"},q=y(" Select "),K=e("th",null,"Title",-1),W=e("th",null,"Total Students",-1),X=["onUpdate:modelValue"],Y={class:"flex justify-center gap-3 my-4 text-center"},Z=y(),$=e("span",{class:"material-icons"},"upload_file",-1),ee=y(" Export "),te=[$,ee],se={key:0},le={class:"mx-auto"},ae=e("label",{for:"",class:"label"},"Search...",-1),oe=e("button",null,null,-1),ne={class:"mx-auto mt-5 overflow-x-auto"},ce={class:"table w-full"},re=e("th",{class:"text-center"},"Rank",-1),ue=e("th",{class:"text-center"},"ID",-1),ie=e("th",{class:"text-center"},"Name",-1),de={class:"text-center"},_e=e("th",{class:"text-center"},"Average Score",-1),he={class:"text-center"},ve={class:"text-center"},me={class:"text-center"},xe={class:"text-center"},ke={setup(u){const s=v([]),l=v([]),f=v([]),g=v([]);(()=>{J.get(U+"?type=examlist").then(r=>{s.value=r.data.routines.map((n,t)=>{let o=[],_="https://script.google.com/macros/s/AKfycbxHZMx1M1oGvp-wPb7mHwQrfkDBpkS3BG0WtciUJ_HHJTswLgJ2Ba4f8XBLNHOkjYEERQ/exec?sheet="+n.exam.substr(39,44);return fetch(_).then(c=>c.json()).then(c=>{o=S.sortBy(c.map(a=>k(b({},a),{attempt:a.attempt||1})),[a=>-a.score,"duration"]).map((a,w)=>k(b({position:1},a),{eid:t,ttrx:a.ttrx?a.ttrx:a.name.split(" ")[0]})),g.value=[...g.value,...o.map(a=>a.ttrx)],s.value[t].results=o,s.value[t].total=o.length}),{select:!1,title:n.topic,results:o}})})})();const m=v(!1),B=()=>{m.value=!0;let r=[...new Set(g.value)];l.value=[],r.forEach(n=>{let t="",o=s.value.filter(c=>c.select).map(c=>{let a=c.results.find(w=>w.ttrx==n);return a?(t=a.name?a.name:a.ttrx,{eid:c.results[0].eid,score:a.score}):{eid:c.results[0].eid,score:0}}),_=o.map(c=>Number(c.score)).reduce((c,a)=>c+a,0);t&&(l.value=[...l.value,{ttrx:n,name:t,score:_,exams:o,average_score:(_/o.length).toFixed(2)}]),l.value=S.sortBy(l.value,[c=>-c.average_score]),f.value=l.value,m.value=l.value.length!=r.length}),m.value=!1},L=()=>{let r="ID,Name,"+s.value.filter(t=>t.select).map(t=>t.title).join(",")+`,Total Score
`;l.value.forEach(t=>{r+=t.ttrx+","+t.name+","+t.exams.map(o=>o.score).join(",")+","+t.score+`
`});var n=document.createElement("a");n.href="data:text/csv;charset=utf-8,"+encodeURI(r),n.target="_blank",n.download="overall_result.csv",n.click()},N=r=>{s.value.forEach(n=>n.select=r.target.checked)},j=r=>{let n=r.target.value;l.value=f.value.filter(t=>t.name.toLowerCase().includes(n.toLowerCase()))};return(r,n)=>(i(),d("div",M,[e("div",O,[G,e("div",P,[e("table",Q,[e("thead",null,[e("tr",null,[e("th",null,[e("input",{type:"checkbox",class:"checkbox",onChange:N},null,32),q]),K,W])]),e("tbody",null,[(i(!0),d(x,null,p(s.value,(t,o)=>(i(),d("tr",{key:o},[e("th",null,[z(e("input",{type:"checkbox",class:"checkbox","onUpdate:modelValue":_=>s.value[o].select=_},null,8,X),[[F,s.value[o].select]])]),e("td",null,h(t.title),1),e("td",null,h(t.total?t.total:"Loading..."),1)]))),128))])])]),e("div",Y,[e("button",{onClick:B,class:T(["capitalize btn",{loading:m.value}])},"Prepare Overall Leaderboard",2),Z,e("button",{class:"btn",onClick:L},te)])]),f.value.length>0?(i(),d("div",se,[e("div",le,[ae,e("input",{type:"text",onInput:j,class:"input input-bordered",placeholder:"Search..."},null,32),oe]),e("div",ne,[e("table",ce,[e("thead",null,[e("tr",null,[re,ue,ie,(i(!0),d(x,null,p(s.value.filter(t=>t.select),t=>(i(),d("th",de,h(t.title),1))),256)),_e])]),e("tbody",null,[(i(!0),d(x,null,p(l.value,(t,o)=>(i(),d("tr",{key:o},[e("td",he,h(o+1),1),e("td",ve,h(t.ttrx),1),e("td",me,h(t.name),1),(i(!0),d(x,null,p(t.exams,_=>(i(),d("td",{class:"text-center",key:_.eid},h(_.score),1))),128)),e("td",xe,h(t.average_score),1)]))),128))])])])])):V("",!0)]))}};export{ke as default};
